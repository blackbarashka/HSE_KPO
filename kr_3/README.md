# Контрольная работа 3. Мусаев Умахан Рашидович


## Описание

Проект реализует интернет-магазин с микросервисной архитектурой, рассчитанный на работу в условиях высокой нагрузки (например, сезонные распродажи). Основной акцент — надежность, масштабируемость и отказоустойчивость процессов создания заказа и оплаты.

---

## Архитектура

- **API Gateway** — единая точка входа, маршрутизация REST-запросов к микросервисам.
- **Orders Service** — управление заказами: создание, просмотр списка, просмотр статуса.
- **Payments Service** — управление счетами: создание счета, пополнение, просмотр баланса, обработка платежей.
- **WebUI** — фронтенд на Razor Pages, взаимодействует с API Gateway.
- **RabbitMQ** — брокер сообщений для асинхронного взаимодействия между сервисами.
- **PostgreSQL** — база данных для Orders и Payments сервисов.
- **Docker/Docker Compose** — контейнеризация и оркестрация всех компонентов.

---

## Используемые технологии

- **.NET 8**, **ASP.NET Core**, **Razor Pages**
- **Entity Framework Core**
- **SignalR** (WebSocket-уведомления о статусе заказа)
- **RabbitMQ** (очереди сообщений)
- **PostgreSQL** (хранение данных)
- **Docker**, **Docker Compose**
- **Swagger** (автоматическая документация API)
- **xUnit**, **Moq**, **FluentAssertions** (тестирование)

---

## Как выполнены требования ТЗ
## **Реализованы все требования ТЗ, включая push-уведомления и фронтенд.**
### 1. Функциональность

- **Payments Service**:
  - Создание счета (один на пользователя)
  - Пополнение счета
  - Просмотр баланса
- **Orders Service**:
  - Создание заказа (асинхронно инициирует оплату через очередь)
  - Просмотр списка заказов пользователя
  - Просмотр статуса заказа

### 2. Архитектурные решения

- **Четкое разделение сервисов**: каждый сервис отвечает только за свою предметную область.
- **Очереди сообщений**: RabbitMQ для асинхронной связи между Orders и Payments.
- **Паттерны**:
  - Transactional Outbox (Orders Service)
  - Transactional Inbox и Outbox (Payments Service)
  - Exactly-once семантика при списании денег (идемпотентность через InboxMessage)
- **Гарантии доставки**: сообщения не теряются, не дублируются, не обрабатываются дважды.
- **Атомарность операций**: транзакции и блокировки на уровне БД, предотвращение гонок при пополнении/списании.

### 3. Документация API

- Swagger UI доступен через API Gateway (`/swagger`), описывает все эндпоинты и сценарии.

### 4. Покрытие тестами

- Покрытие тестами (xUnit) > 65% для Orders и Payments сервисов.
- Тестируются бизнес-логика, сценарии ошибок, интеграция с очередями.

### 5. Docker и запуск

- Каждый сервис — отдельный Docker-контейнер.
- `docker-compose.yml` разворачивает всю систему одной командой.
- После запуска все сервисы доступны и готовы к работе.

### 6. Фронтенд

- WebUI на Razor Pages, отдельный сервис.
- Взаимодействие с бэкендом через REST API.
- Упакован в Docker, запускается через Compose.

### 7. WebSocket-уведомления

- SignalR (Orders Service) — push-уведомления о смене статуса заказа.
- WebUI подключается к SignalR и отображает уведомления пользователю.

---

## Как запустить проект

1. **Запустите Docker Desktop**
2.  **Запустите все сервисы:**
    `docker-compose up --build`

## **Доступы:**
- WebUI: [http://localhost:8080](http://localhost:8080)
- Swagger (API Gateway): [http://localhost:8000/swagger](http://localhost:8000/swagger)
- RabbitMQ: [http://localhost:15672](http://localhost:15672) (логин/пароль: guest/guest)

   
---

## Тестирование и покрытие

- Запуск тестов:
  `dotnet test`
